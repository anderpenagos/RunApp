name: Mostrar SHA-1

on:
  workflow_dispatch:  # Execu√ß√£o manual

jobs:
  show-sha1:
    name: Mostrar SHA-1 dos Certificados
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
      
      - name: üì± SHA-1 do Debug Keystore
        run: |
          echo "================================================"
          echo "üîë SHA-1 do Certificado DEBUG"
          echo "================================================"
          echo ""
          echo "Este √© o SHA-1 que voc√™ usa durante desenvolvimento."
          echo "Configure este no Google Cloud Console para testar o app."
          echo ""
          
          # O GitHub Actions usa um debug.keystore padr√£o
          # Vamos criar um se n√£o existir
          if [ ! -f ~/.android/debug.keystore ]; then
            mkdir -p ~/.android
            keytool -genkey -v -keystore ~/.android/debug.keystore \
              -storepass android -alias androiddebugkey \
              -keypass android -keyalg RSA -keysize 2048 -validity 10000 \
              -dname "CN=Android Debug,O=Android,C=US"
          fi
          
          # Mostra o SHA-1
          keytool -list -v -keystore ~/.android/debug.keystore \
            -alias androiddebugkey -storepass android -keypass android \
            2>/dev/null | grep -A 2 "Certificate fingerprints" | grep SHA1
          
          echo ""
          echo "================================================"
          
          # Salva em um arquivo tamb√©m
          SHA1_DEBUG=$(keytool -list -v -keystore ~/.android/debug.keystore \
            -alias androiddebugkey -storepass android -keypass android \
            2>/dev/null | grep SHA1 | awk '{print $2}')
          
          echo "SHA1_DEBUG=$SHA1_DEBUG" >> $GITHUB_ENV
      
      - name: üì± SHA-1 do Release Keystore (se existir)
        run: |
          echo ""
          echo "================================================"
          echo "üîë SHA-1 do Certificado RELEASE"
          echo "================================================"
          echo ""
          
          # Verifica se voc√™ tem keystore de release configurado
          if [ -f "release-key.jks" ] || [ -f "app/release-key.jks" ]; then
            echo "‚úÖ Keystore de release encontrado!"
            echo ""
            echo "Para ver o SHA-1 do release, voc√™ precisa:"
            echo "1. Ter o arquivo keystore.jks no reposit√≥rio (N√ÉO recomendado!) OU"
            echo "2. Usar o keystore localmente com o comando keytool"
            echo ""
            echo "Se voc√™ tem o keystore guardado em seguran√ßa (fora do git),"
            echo "execute este comando NO SEU COMPUTADOR:"
            echo ""
            echo "keytool -list -v -keystore /caminho/para/seu.jks -alias seu_alias"
            echo ""
          else
            echo "‚ö†Ô∏è  Keystore de release n√£o encontrado no projeto"
            echo ""
            echo "Voc√™ tem duas op√ß√µes:"
            echo ""
            echo "OP√á√ÉO 1 - Usar apenas Debug (Para testes):"
            echo "  - Configure apenas o SHA-1 de debug no Google Cloud"
            echo "  - Use APKs de debug para testar"
            echo ""
            echo "OP√á√ÉO 2 - Criar Keystore de Release (Para produ√ß√£o):"
            echo "  - Execute no seu computador:"
            echo "    keytool -genkey -v -keystore release-key.jks -keyalg RSA \\"
            echo "      -keysize 2048 -validity 10000 -alias runapp_release"
            echo "  - Guarde o keystore em local SEGURO (N√ÉO no git!)"
            echo "  - Configure secrets no GitHub Actions"
            echo ""
          fi
          
          echo "================================================"
      
      - name: üìã Criar Resumo
        run: |
          echo "# üîê Certificados SHA-1 do RunApp" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## üîë Certificado DEBUG" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**SHA-1:** \`$SHA1_DEBUG\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üìù Como usar no Google Cloud Console:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Acesse: https://console.cloud.google.com" >> $GITHUB_STEP_SUMMARY
          echo "2. V√° em: **APIs & Services** ‚Üí **Credentials**" >> $GITHUB_STEP_SUMMARY
          echo "3. Clique na sua API Key do Maps" >> $GITHUB_STEP_SUMMARY
          echo "4. Em **Application restrictions**, selecione: **Android apps**" >> $GITHUB_STEP_SUMMARY
          echo "5. Clique em **Add an item**:" >> $GITHUB_STEP_SUMMARY
          echo "   - **Package name:** \`com.runapp\`" >> $GITHUB_STEP_SUMMARY
          echo "   - **SHA-1 certificate fingerprint:** \`$SHA1_DEBUG\`" >> $GITHUB_STEP_SUMMARY
          echo "6. Clique em **Save**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ‚ö†Ô∏è Importante" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Este SHA-1 √© para **builds de debug/desenvolvimento**" >> $GITHUB_STEP_SUMMARY
          echo "- Para produ√ß√£o, voc√™ precisar√° criar um **keystore de release**" >> $GITHUB_STEP_SUMMARY
          echo "- **NUNCA** commite keystores no Git!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## üì± Package Name" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Package:** \`com.runapp\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üí° **Dica:** Copie o SHA-1 acima e cole no Google Cloud Console!" >> $GITHUB_STEP_SUMMARY
      
      - name: üí¨ Enviar SHA-1 para Telegram (Opcional)
        if: ${{ secrets.TELEGRAM_BOT_TOKEN != '' && secrets.TELEGRAM_CHAT_ID != '' }}
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MESSAGE="üîê *SHA-1 do RunApp*%0A%0A"
          MESSAGE="${MESSAGE}üì± *Package:* \`com.runapp\`%0A"
          MESSAGE="${MESSAGE}üîë *SHA-1 Debug:* \`$SHA1_DEBUG\`%0A%0A"
          MESSAGE="${MESSAGE}üìù *Configure no Google Cloud:*%0A"
          MESSAGE="${MESSAGE}APIs & Services ‚Üí Credentials ‚Üí API Key%0A%0A"
          MESSAGE="${MESSAGE}Application restrictions:%0A"
          MESSAGE="${MESSAGE}‚Üí Android apps%0A"
          MESSAGE="${MESSAGE}‚Üí Add item:%0A"
          MESSAGE="${MESSAGE}   ‚Ä¢ Package: \`com.runapp\`%0A"
          MESSAGE="${MESSAGE}   ‚Ä¢ SHA-1: \`$SHA1_DEBUG\`"
          
          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"chat_id\": \"$TELEGRAM_CHAT_ID\", \"text\": \"$MESSAGE\", \"parse_mode\": \"Markdown\"}" \
               "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" || true
